@inherits LayoutComponentBase
@using Budgetr.Shared.Services
@inject IPwaService PwaService
@implements IDisposable

<div class="app-container">
    <main class="main-content">
        @if (!PwaService.IsOnline)
        {
            <div class="offline-banner">
                <span class="offline-icon">ðŸ“¡</span>
                <span>You are working offline</span>
            </div>
        }
        
        @if (PwaService.IsInstallable)
        {
            <div class="install-prompt">
                <div class="install-content">
                    <span class="install-icon">ðŸ“±</span>
                    <div class="install-text">
                        <span class="install-title">Install Budgetr</span>
                        <span class="install-desc">Add to home screen for quick access</span>
                    </div>
                </div>
                <button class="install-btn" @onclick="InstallApp">Install</button>
            </div>
        }

        @Body
    </main>
    
    <nav class="bottom-nav">
        <NavLink href="" class="nav-item" Match="NavLinkMatch.All">
            <div class="nav-icon nav-icon-overview"></div>
            <span class="nav-label">Overview</span>
        </NavLink>
        <NavLink href="meters" class="nav-item">
            <div class="nav-icon nav-icon-meters"></div>
            <span class="nav-label">Meters</span>
        </NavLink>
        <NavLink href="timeline" class="nav-item">
            <div class="nav-icon nav-icon-timeline"></div>
            <span class="nav-label">Timeline</span>
        </NavLink>
        <NavLink href="history" class="nav-item">
            <div class="nav-icon nav-icon-history"></div>
            <span class="nav-label">History</span>
        </NavLink>
        <NavLink href="sync" class="nav-item">
            <div class="nav-icon nav-icon-sync"></div>
            <span class="nav-label">Sync</span>
        </NavLink>
    </nav>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        PwaService.OnStateChanged += StateHasChanged;
        
        await PwaService.InitializeAsync();
    }

    private async Task InstallApp()
    {
        await PwaService.InstallAppAsync();
    }

    public void Dispose()
    {
        PwaService.OnStateChanged -= StateHasChanged;
    }
}
